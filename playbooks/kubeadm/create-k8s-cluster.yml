---
- name: Create Kubernetes cluster
  hosts: kube_control_plane,kube_node
  become: true
  become_user: root
  roles:
    - role: kubeadm/validate
    - role: kubeadm/kubeadm-join
    - role: deploy-cni-plugin
      tags: cni
  serial: 1
  vars:
    apply_k8s_version: "v1.33.2"  # https://kubernetes.io/releases/
    k8s_version: "{{ apply_k8s_version | regex_search ('v[0-9]+\\.[0-9]+') }}"
    k8s_component_version: "{{ apply_k8s_version | regex_search ('[0-9]+\\.[0-9]+\\.[0-9]+') }}"
    public_key_k8s_version: "{{ apply_k8s_version | regex_search ('v[0-9]+\\.[0-9]+') }}"
    cilium_version: "1.17.6"  # https://github.com/cilium/cilium/releases
    flannel_version: "latest"  # https://github.com/flannel-io/flannel/releases
    calico_version: "v3.30.2"  # https://github.com/projectcalico/calico/releases

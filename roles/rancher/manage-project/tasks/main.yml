---
- name: Validate required variables
  ansible.builtin.fail:
    msg: "Required variables missing: cluster_id, and rancher_projects"
  when:
    - cluster_id is not defined or cluster_id | length == 0
    - rancher_projects is not defined
  run_once: true

- name: Set projects list from file or variable
  ansible.builtin.set_fact:
    projects_to_manage: "{{ rancher_projects }}"
  run_once: true

- name: Manage Rancher projects
  ansible.builtin.include_tasks: manage-project-item.yml
  loop: "{{ projects_to_manage }}"
  loop_control:
    loop_var: project_item
  run_once: true

- name: Display projects management summary
  ansible.builtin.debug:
    msg:
      - "Rancher projects management completed!"
      - "Total projects processed: {{ projects_to_manage | length }}"
      - "Projects:"
      - "{{ projects_to_manage | map(attribute='name') | list }}"
  run_once: true
